<?php defined('BASEPATH') or exit('No direct script access allowed'); ?><?php init_head();?><div id="wrapper" >    <div class="content">        <div class="row">            <div class="panel_s">                <div class="panel-heading">                    <div>                        <strong style="font-size: 20px"> <?php echo _l('email_template_manage_timer_for_clients_and_leads')?> </strong>                        <a style="float: right" href="#" onclick="fnc_template_dlg( 0 , 0 ) " class="btn btn-primary" > <i class="fa fa-add"> </i> <?php echo _l('email_template_manage_add_timer')?> </a>                    </div>                </div>                <div class="panel-body">                    <div class="table-responsive ">                        <table class="table table-templates">                            <thead>                                <th><?php echo _l('id')?></th>                                <th><?php echo _l('name')?></th>                                <th><?php echo _l('email_template_manage_template_name')?></th>                                <th><?php echo _l('email_template_manage_send_date')?></th>                                <th><?php echo _l('email_template_manage_send_hour')?></th>                                <th><?php echo _l('email_template_manage_sending_status')?></th>                                <th><?php echo _l('email_template_manage_status')?></th>                            </thead>                            <tbody>                            </tbody>                        </table>                    </div>                </div>            </div>        </div>    </div></div><div class="modal fade" id="template_definition" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">    <div class="modal-dialog modal-lg" role="document">        <div class="modal-content" id="template_definition_content">        </div>    </div></div><div class="modal fade" id="template_definition_logs" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">    <div class="modal-dialog modal-xl" role="document">        <div class="modal-content" id="template_definition_logs_content">        </div>    </div></div><div class="modal fade" id="template_send_now" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">    <div class="modal-dialog modal-xl" role="document">        <div class="modal-header">            <button type="button" class="close" data-dismiss="modal" aria-label="Close">                <span aria-hidden="true">&times;</span>            </button>            <h4 class="modal-title" id="myModalLabel">                <span class="edit-title "><?php echo _l('email_template_manage_send_now'); ?> </span>            </h4>        </div>        <div class="modal-content" id="template_send_now_content">        </div>    </div></div><?php init_tail(); ?><script>    $(document).ready(function (){        initDataTable('.table-templates', admin_url + 'email_template_manage/timer_list', [], [], [] , [0,"desc"] );        $('#template_send_now').on('hidden.bs.modal', function (e) {            $('.table-templates').DataTable().ajax.reload();        });    })    function fnc_template_dlg( record_id , is_duplicate = 0 )    {        $.post(admin_url+"email_template_manage/timer_detail" , { record_id : record_id , is_duplicate : is_duplicate } )            .done(function ( response ){                response = JSON.parse(response);                $('#template_definition_content').html(response.content_html).promise().done(function (){                    init_selectpicker();                });                $('#template_definition').modal();            });    }    function fnc_template_sending_dlg( record_id )    {        $.post(admin_url+"email_template_manage/mail_send_logs" , { record_id : record_id } )            .done(function ( response ){                response = JSON.parse(response);                $('#template_definition_logs_content').html( response.content_html ).promise().done(function (){                    init_datepicker();                });                $('#template_definition_logs').modal();            });    }    function fnc_template_send_now( record_id )    {        /*$.post(admin_url+"email_template_manage/mail_send_now" , { record_id : record_id } )            .done(function (){                alert_float( "success" , "Email sending was successfully triggered" );                $('.table-templates').DataTable().ajax.reload();            });*/        var convertUrl = admin_url+"email_template_manage/mail_send_now_iframe/"+record_id;        $('#template_send_now_content').html(            '<div align="center" style="min-height: 350px;">'+            '<h4 style="color:blue"> <?php echo _l("email_template_manage_iframe_message")?>  </h4><hr>'+            '<iframe id="frameSmStatusUpdate" src="'+convertUrl+'" frameborder="0" style="width: 100%;min-height: 380px;"></iframe>'+            '</div>');        $('#template_send_now').modal();    }    function fnc_template_clear_record( template_id , clear_type )    {        var template_send_again_date = $('#template_send_again_date').val();        if( template_send_again_date.length > 0 )        {            $.post(admin_url+"email_template_manage/mail_clear_record" , {                    template_id : template_id ,                    clear_type : clear_type ,                    send_date : template_send_again_date ,                } ).done(function (){                    alert_float( "success" , "Successfully" );                    $('#template_definition_logs').modal('hide');                    $('.table-templates').DataTable().ajax.reload();                });        }        else        {            $('#template_send_again_date').focus();        }    }</script>