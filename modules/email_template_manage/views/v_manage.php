<?php defined('BASEPATH') or exit('No direct script access allowed'); ?><?php init_head();?><div id="wrapper" >    <div class="content">        <div class="row">            <div class="panel_s">                <div class="panel-heading">                    <div>                        <strong style="font-size: 20px"> <?php echo _l('email_template_manage')?> </strong>                        <a style="float: right" href="#" onclick="fnc_template_dlg( 0 , 0 ) " class="btn btn-primary" > <i class="fa fa-add"> </i> <?php echo _l('email_template_manage_add_new')?> </a>                    </div>                </div>                <div class="panel-body">                    <div class="table-responsive ">                        <table class="table table-templates">                            <thead>                                <tr>                                    <th><?php echo _l('id')?></th>                                    <th><?php echo _l('email_template_manage_template_name')?></th>                                    <th><?php echo _l('email_template_manage_email_subject')?></th>                                    <th><?php echo _l('email_template_manage_related_type')?></th>                                    <th><?php echo _l('email_template_manage_status')?></th>                                </tr>                            </thead>                            <tbody>                            </tbody>                        </table>                    </div>                </div>            </div>        </div>    </div></div><div class="modal fade" id="template_definition" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">    <div class="modal-dialog modal-xxl" role="document">        <div class="modal-content" id="template_definition_content">        </div>    </div></div><input type="hidden" name="_attachment_sale_type" id="_attachment_sale_type" value="email_template" /><input type="hidden" name="_attachment_sale_id" id="_attachment_sale_id" value="0" /><?php $this->load->view('admin/includes/modals/sales_attach_file'); ?><?php init_tail(); ?><script>    $(document).ready(function (){        initDataTable('.table-templates', admin_url + 'email_template_manage/lists' , false , false , [] , [0,"desc"] );        init_editor('textarea[name="template_content"]', {            urlconverter_callback: 'merge_field_format_url',        });        var template_id = <?php echo !empty($template_id) ? $template_id :0?>;        if (template_id > 0 )            fnc_template_dlg(template_id);    });    function delete_email_template_manage_attachment(id) {        if (confirm_delete()) {            requestGet("email_template_manage/delete_attachment/" + id)                .done(function (success) {                    if (success == 1) {                        $("body")                            .find('[data-attachment-id="' + id + '"]')                            .remove();                    }                })                .fail(function (error) {                    alert_float("danger", error.responseText);                });        }    }    function fnc_template_attach( record_id )    {        $('#_attachment_sale_id').val( record_id );        $('#sales_attach_file').modal();    }    function fnc_template_dlg( record_id , is_duplicate = 0 )    {        $.post(admin_url+"email_template_manage/detail" , { record_id : record_id } )            .done(function ( response ){                response = JSON.parse(response);                $('#template_definition_content').html(response.content_html).promise().done(function (){                    $('.add_merge_field').on('click', function(e) {                        e.preventDefault();                        tinymce.activeEditor.execCommand('mceInsertContent', false, $(this).find('.add_merge_field_span').text());                    });                    init_selectpicker();                });                $('#template_name').val('');                $('#template_subject').val('');                $('#template_definition').find('#id').val(0);                if( response.data )                {                    $('#template_name').val( response.data.template_name );                    $('#template_subject').val( response.data.template_subject );                    if( is_duplicate != 1 )                        $('#template_definition').find('#id').val( response.data.id );                }                $('#template_definition').modal();                tinyMCE.remove(".tinymce-manual");                init_editor('textarea[name="template_content"]', {                    urlconverter_callback: 'merge_field_format_url',                });            });    }</script>